"0","library(""car"")"
"0","library(""Matching"")"
"0","## experimental data"
"0","lalonde = read.csv(""cps1re74.csv"", sep = "" "")"
"0","y = lalonde$re78"
"0","z = lalonde$treat"
"0","x = as.matrix(lalonde[, c(""age"", ""educ"", ""black"","
"0","                          ""hispan"", ""married"", ""nodegree"","
"0","                          ""re74"", ""re75"")])"
"0","## analysis the randomized experiment via"
"0","# Lin's Estimator"
"0","xc = scale(x)"
"0","linols = lm(y ~ z + xc + z*xc)"
"0","tau_Lin = linols$coefficients[2]"
"0","round(summary(linols)$coef[2, ], 4)"
"1","  Estimate "
"1","Std. Error "
"1","   t value "
"1","  Pr(>|t|) "
"1","
"
"1","-3689.8516 "
"1"," 2457.3996 "
"1","   -1.5015 "
"1","    0.1332 "
"1","
"
"0","sqrt(hccm(linols)[2, 2])"
"1","[1]"
"1"," 3428.439"
"1","
"
"0","# Regression Imputation Shall return the same results as Lin"
"0","model1 = lm(y[z == 1]~x[z == 1,])"
"0","model0 = lm(y[z == 0]~x[z == 0,])"
"0","tau_reg = mean(cbind(1, x) %*% model1$coefficients - cbind(1, x) %*% model0$coefficients)"
"0","tau_Lin - tau_reg"
"1","           z "
"1","
"
"1","3.187779e-09 "
"1","
"
"0","# Propensity score stratification"
"0","pscore = glm(z ~ x, family = binomial)$fitted.values"
"0","tau_pSRE = c()"
"0","for (i in 2:5){"
"0","  stratum = floor(pscore*i) + 1"
"0","  obsValue <- stat_SRE(stratum, z, y)"
"0","  tau_pSRE = c(tau_pSRE, obsValue[1])"
"0","}"
"0","tau_pSRE"
"1","     taus "
"1","     taus "
"1","     taus "
"1","     taus "
"1","
"
"1","-8506.495 "
"1","-7804.194 "
"1","-7706.861 "
"1","-7625.539 "
"1","
"
"0","# IPW estimator"
"0","# With no truncation"
"0","truncpscore = c(0,1)"
"0","pscore = glm(z ~ x, family = binomial)$fitted.values"
"0","pscore = pmax(truncpscore[1], pmin(truncpscore[2], pscore))"
"0","ipw_1 = mean(z*y/pscore - (1 - z)*y/(1 - pscore))"
"0","ipw_hajek_1 = mean(z*y/pscore)/mean(z/pscore) - mean((1 - z)*y/(1 - pscore))/mean((1 - z)/(1 - pscore))"
"0","# With certain truncation"
"0","truncpscore = c(0.1,0.9)"
"0","pscore = glm(z ~ x, family = binomial)$fitted.values"
"0","pscore = pmax(truncpscore[1], pmin(truncpscore[2], pscore))"
"0","ipw_2 = mean(z*y/pscore - (1 - z)*y/(1 - pscore))"
"0","ipw_hajek_2 = mean(z*y/pscore)/mean(z/pscore) - mean((1 - z)*y/(1 - pscore))/mean((1 - z)/(1 - pscore))"
"0","# Doubly Robust Estimator"
"0","outcome1 = glm(y ~ x, weights = z, family = gaussian)$fitted.values"
"0","outcome0 = glm(y ~ x, weights = (1 - z), family = gaussian)$fitted.values"
"0","res1 = y - outcome1"
"0","res0 = y - outcome0"
"0","tau_dr = mean(outcome1 - outcome0) + mean(z*res1/pscore - (1 - z)*res0/(1 - pscore))"
"0","print(paste(""Lin's estimator is "", tau_Lin, sep = """"))"
"1","[1]"
"1"," ""Lin's estimator is -3689.8515880728"""
"1","
"
"0","print(paste(""Regression Imputation gives us an estimate same as Lin's "", tau_reg, sep = """"))"
"1","[1]"
"1"," ""Regression Imputation gives us an estimate same as Lin's -3689.85158807599"""
"1","
"
"0","print(paste(""pscore stratification's estimator is "", tau_pSRE, sep = """"))"
"1","[1]"
"1"," ""pscore stratification's estimator is -8506.49536105039"""
"1"," ""pscore stratification's estimator is -7804.1941784074"" "
"1","
"
"1","[3]"
"1"," ""pscore stratification's estimator is -7706.8611458836"" "
"1"," ""pscore stratification's estimator is -7625.53852433987"""
"1","
"
"0","print(paste(""IPW estimator (hovic-thompson) without truncation is "",ipw_1, "" and the hajek estimator is "",ipw_hajek_1 ,sep = """"))"
"1","[1]"
"1"," ""IPW estimator (hovic-thompson) without truncation is -10452.7456142986 and the hajek estimator is -6464.79903460242"""
"1","
"
"0","print(paste(""IPW estimator (hovic-thompson) with truncation is "",ipw_2, "" and the hajek estimator is "",ipw_hajek_2 ,sep = """"))"
"1","[1]"
"1"," ""IPW estimator (hovic-thompson) with truncation is -15955.5388374637 and the hajek estimator is -7870.10636452558"""
"1","
"
"0","print(paste(""The doubly robust estimator is "", tau_dr))"
"1","[1]"
"1"," ""The doubly robust estimator is  -3688.65001081252"""
"1","
"
