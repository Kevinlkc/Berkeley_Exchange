"0","# Propensity score stratification"
"0","pscore = glm(z ~ x, family = binomial(link = ""probit""))$fitted.values"
"0","tau_pSRE = c()"
"0","for (i in 2:5){"
"0","  stratum = floor(pscore*i) + 1"
"0","  obsValue <- stat_SRE(stratum, z, y)"
"0","  tau_pSRE = c(tau_pSRE, obsValue[1])"
"0","}"
"0","# IPW estimator"
"0","# With no truncation"
"0","truncpscore = c(0,1)"
"0","pscore = glm(z ~ x, family = binomial(link = ""probit""))$fitted.values"
"0","pscore = pmax(truncpscore[1], pmin(truncpscore[2], pscore))"
"0","ipw_1 = mean(z*y/pscore - (1 - z)*y/(1 - pscore))"
"0","ipw_hajek_1 = mean(z*y/pscore)/mean(z/pscore) - mean((1 - z)*y/(1 - pscore))/mean((1 - z)/(1 - pscore))"
"0","# With certain truncation"
"0","truncpscore = c(0.1,0.9)"
"0","pscore = glm(z ~ x, family = binomial(link = ""probit""))$fitted.values"
"0","pscore = pmax(truncpscore[1], pmin(truncpscore[2], pscore))"
"0","ipw_2 = mean(z*y/pscore - (1 - z)*y/(1 - pscore))"
"0","ipw_hajek_2 = mean(z*y/pscore)/mean(z/pscore) - mean((1 - z)*y/(1 - pscore))/mean((1 - z)/(1 - pscore))"
"0","# Doubly Robust Estimator"
"0","outcome1 = glm(y ~ x, weights = z, family = gaussian)$fitted.values"
"0","outcome0 = glm(y ~ x, weights = (1 - z), family = gaussian)$fitted.values"
"0","res1 = y - outcome1"
"0","res0 = y - outcome0"
"0","tau_dr = mean(outcome1 - outcome0) + mean(z*res1/pscore - (1 - z)*res0/(1 - pscore))"
"0","print(""If we fit e(x) by probit model,"")"
"1","[1]"
"1"," ""If we fit e(x) by probit model,"""
"1","
"
"0","print(paste(""Lin's estimator is "", tau_Lin, sep = """"))"
"1","[1]"
"1"," ""Lin's estimator is -3689.8515880728"""
"1","
"
"0","print(paste(""Regression Imputation gives us an estimate same as Lin's "", tau_reg, sep = """"))"
"1","[1]"
"1"," ""Regression Imputation gives us an estimate same as Lin's -3689.85158807599"""
"1","
"
"0","print(paste(""pscore stratification's estimator is "", tau_pSRE, sep = """"))"
"1","[1]"
"1"," ""pscore stratification's estimator is -8506.49536105039"""
"1"," ""pscore stratification's estimator is -7826.07775869297"""
"1","
"
"1","[3]"
"1"," ""pscore stratification's estimator is -7199.12284967037"""
"1"," ""pscore stratification's estimator is -7185.93488163915"""
"1","
"
"0","print(paste(""IPW estimator (hovic-thompson) without truncation is "",ipw_1, "" and the hajek estimator is "",ipw_hajek_1 ,sep = """"))"
"1","[1]"
"1"," ""IPW estimator (hovic-thompson) without truncation is -8738.13952518101 and the hajek estimator is -6452.09781690384"""
"1","
"
"0","print(paste(""IPW estimator (hovic-thompson) with truncation is "",ipw_2, "" and the hajek estimator is "",ipw_hajek_2 ,sep = """"))"
"1","[1]"
"1"," ""IPW estimator (hovic-thompson) with truncation is -15953.1987455341 and the hajek estimator is -7869.30235400649"""
"1","
"
"0","print(paste(""The doubly robust estimator is "", tau_dr))"
"1","[1]"
"1"," ""The doubly robust estimator is  -3686.27091355767"""
"1","
"
"0","print(""The doubly robust estimator is the one closest to the golden rule estimation."")"
"1","[1]"
"1"," ""The doubly robust estimator is the one closest to the golden rule estimation."""
"1","
"
