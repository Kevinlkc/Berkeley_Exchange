"0","karolinska = read.table(""karolinska.txt"", header = TRUE)"
"0","z = karolinska$HighVolDiagHosp"
"0","y = 1 - (karolinska$YearsSurvivingAfterDiagnosis == 1)"
"0","x = as.matrix(karolinska[, c(3, 4, 5)])"
"0","pscore = glm(z ~ x, family = binomial)$fitted.values"
"0","# Propensity Score Estimator"
"0","stat_SRE <- function(stratum, treatment, y){"
"0","  # Assume in our case that the stratum in arranged and indexed."
"0","  # If not, then re-code it to an index."
"0","  number = length(unique(stratum))"
"0","  tau = 0"
"0","  wil = 0"
"0","  r = 0"
"0","  # Calculate the three statistics as defined"
"0","  for (i in 1:number){"
"0","    tempy = y[stratum == i]"
"0","    tempt = treatment[stratum == i]"
"0","    n = length(tempy)"
"0","    pi = n/length(y)"
"0","    tau = tau + pi*(mean(tempy[tempt == 1] - mean(tempy[tempt == 0])))"
"0","    tempy = tempy - mean(tempy)"
"0","  }"
"0","  y <- rank(y)"
"0","  for (i in 1:length(y)){"
"0","    if (treatment[i] == 1){"
"0","      r = r + y[i]"
"0","    }"
"0","  }"
"0","  return(c(taus = tau, alignedRank = r))"
"0","}"
"0","# Here we obtain the obs. values"
"0","tau_pSRE = c()"
"0","for (i in 1:4){"
"0","  stratum = floor(pscore*i) + 1"
"0","  obsValue <- stat_SRE(stratum, z, y)"
"0","  tau_pSRE = c(tau_pSRE, obsValue[1])"
"0","}"
"0","ggplot()+"
"0","  theme_bw() +"
"0","  geom_point(aes(x = 1:4, y = tau_pSRE), color = 'maroon', size = 2) +"
"0","  geom_line(aes(x = 1:4, y = tau_pSRE), color = 'maroon', size = 1)"
