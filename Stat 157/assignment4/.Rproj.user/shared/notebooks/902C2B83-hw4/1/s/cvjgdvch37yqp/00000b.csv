"0","library(MatchIt)"
"0","data <- read.csv(""FDA-Carpenter.csv"")"
"0","# We perform similar data treatment "
"0","# The democrat is the senate is the treatment indicator, acttime is Y, and others are covariate."
"0","## rescaling"
"0","data$hospdisc <- data$hospdisc/100000"
"0","data$natreg <- data$natreg/100"
"0","data$stafcder <- data$stafcder/100"
"0","data$prevgenx <- data$prevgenx/100"
"0","data$hhosleng <- data$hhosleng/10"
"0","data$condavg3 <- data$condavg3/10"
"0","data$orderent <- data$orderent/10"
"0","data$vandavg3 <- data$vandavg3/10"
"0","data$wpnoavg3 <- data$wpnoavg3/100"
"0","z <- data$demsnmaj"
"0","y <- data$acttime"
"0","x <- as.matrix(data %>%"
"0","  dplyr::select(-demsnmaj, -acttime))"
"0","## analysis the randomized experiment via"
"0","# Lin's Estimator"
"0","xc = scale(x)"
"0","linols = lm(y ~ z + xc + z*xc)"
"0","tau_Lin = linols$coefficients[2]"
"0","round(summary(linols)$coef[2, ], 4)"
"1","  Estimate "
"1","Std. Error "
"1","   t value "
"1","  Pr(>|t|) "
"1","
"
"1","  -13.8625 "
"1","    4.4678 "
"1","   -3.1027 "
"1","    0.0021 "
"1","
"
"0","sqrt(hccm(linols)[2, 2])"
"1","[1]"
"1"," 4.389857"
"1","
"
"0","# Regression Imputation Shall return the same results as Lin"
"0","model1 = lm(y[z == 1]~x[z == 1,])"
"0","model0 = lm(y[z == 0]~x[z == 0,])"
"0","tau_reg = mean(cbind(1, x) %*% model1$coefficients - cbind(1, x) %*% model0$coefficients)"
"0","# Propensity score stratification"
"0","pscore = glm(z ~ x, family = binomial)$fitted.values"
"0","tau_pSRE = c()"
"0","for (i in 2:5){"
"0","  stratum = floor(pscore*i) + 1"
"0","  obsValue <- stat_SRE(stratum, z, y)"
"0","  tau_pSRE = c(tau_pSRE, obsValue[1])"
"0","}"
"0","tau_pSRE"
"1","     taus "
"1","     taus "
"1","     taus "
"1","     taus "
"1","
"
"1","-11.78213 "
"1","-13.49131 "
"1","-14.69429 "
"1","-16.93254 "
"1","
"
"0","# IPW estimator"
"0","# With no truncation"
"0","truncpscore = c(0,1)"
"0","pscore = glm(z ~ x, family = binomial)$fitted.values"
"0","pscore = pmax(truncpscore[1], pmin(truncpscore[2], pscore))"
"0","ipw_1 = mean(z*y/pscore - (1 - z)*y/(1 - pscore))"
"0","ipw_hajek_1 = mean(z*y/pscore)/mean(z/pscore) - mean((1 - z)*y/(1 - pscore))/mean((1 - z)/(1 - pscore))"
"0","# With certain truncation"
"0","truncpscore = c(0.1,0.9)"
"0","pscore = glm(z ~ x, family = binomial)$fitted.values"
"0","pscore = pmax(truncpscore[1], pmin(truncpscore[2], pscore))"
"0","ipw_2 = mean(z*y/pscore - (1 - z)*y/(1 - pscore))"
"0","ipw_hajek_2 = mean(z*y/pscore)/mean(z/pscore) - mean((1 - z)*y/(1 - pscore))/mean((1 - z)/(1 - pscore))"
"0","# Doubly Robust Estimator"
"0","outcome1 = glm(y ~ x, weights = z, family = gaussian)$fitted.values"
"0","outcome0 = glm(y ~ x, weights = (1 - z), family = gaussian)$fitted.values"
"0","res1 = y - outcome1"
"0","res0 = y - outcome0"
"0","tau_dr = mean(outcome1 - outcome0) + mean(z*res1/pscore - (1 - z)*res0/(1 - pscore))"
"0","print(paste(""Lin's estimator is "", tau_Lin, sep = """"))"
"1","[1]"
"1"," ""Lin's estimator is -13.8624685450355"""
"1","
"
"0","print(paste(""Regression Imputation gives us an estimate same as Lin's "", tau_reg, sep = """"))"
"1","[1]"
"1"," ""Regression Imputation gives us an estimate same as Lin's -13.8624685450355"""
"1","
"
"0","print(paste(""pscore stratification's estimator is "", tau_pSRE, sep = """"))"
"1","[1]"
"1"," ""pscore stratification's estimator is -11.7821330501416"""
"1"," ""pscore stratification's estimator is -13.4913054500575"""
"1","
"
"1","[3]"
"1"," ""pscore stratification's estimator is -14.6942924219253"""
"1"," ""pscore stratification's estimator is -16.9325445893505"""
"1","
"
"0","print(paste(""IPW estimator (hovic-thompson) without truncation is "",ipw_1, "" and the hajek estimator is "",ipw_hajek_1 ,sep = """"))"
"1","[1]"
"1"," ""IPW estimator (hovic-thompson) without truncation is -14.6313842730615 and the hajek estimator is -12.2855037951194"""
"1","
"
"0","print(paste(""IPW estimator (hovic-thompson) with truncation is "",ipw_2, "" and the hajek estimator is "",ipw_hajek_2 ,sep = """"))"
"1","[1]"
"1"," ""IPW estimator (hovic-thompson) with truncation is -14.6646978648039 and the hajek estimator is -12.2464521272955"""
"1","
"
"0","print(paste(""The doubly robust estimator is "", tau_dr))"
"1","[1]"
"1"," ""The doubly robust estimator is  -12.6943681855002"""
"1","
"
