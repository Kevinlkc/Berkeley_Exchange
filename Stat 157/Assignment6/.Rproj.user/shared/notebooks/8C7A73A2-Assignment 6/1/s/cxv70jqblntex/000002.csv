"0","IV_Lin = function(Z, D, Y, X)"
"0","{"
"0","  X = as.matrix(X)"
"0","  D = as.matrix(D)"
"0","  Y = as.matrix(Y)"
"0","  Z = as.matrix(Z)"
"0","  tau_D = lm(D ~ Z + X + Z*X)$coef[2]"
"0","  tau_Y = lm(Y ~ Z + X + Z*X)$coef[2]"
"0","  names(tau_D) = NULL"
"0","  names(tau_Y) = NULL"
"0","  CACE  = tau_Y/tau_D"
"0","  "
"0","  return(list(tau_D = tau_D, tau_Y = tau_Y,"
"0","              CACE  = CACE))"
"0","}"
"0","## IV_adj se via the delta method"
"0","IV_Lin_delta = function(Z, D, Y, X)"
"0","{"
"0","  X = as.matrix(X)"
"0","  D = as.matrix(D)"
"0","  Y = as.matrix(Y)"
"0","  Z = as.matrix(Z)"
"0","  est    = IV_Lin(Z, D, Y, X)"
"0","  "
"0","  betaY1 = lm(Y ~ X, subset = (Z == 1))$coef[-1]"
"0","  betaY0 = lm(Y ~ X, subset = (Z == 0))$coef[-1]"
"0","  betaD1 = lm(D ~ X, subset = (Z == 1))$coef[-1]"
"0","  betaD0 = lm(D ~ X, subset = (Z == 0))$coef[-1]"
"0","  "
"0","  AdjustedY1   = Y - X%*%betaY1 - "
"0","                     (D - X%*%betaD1)*est$CACE"
"0","  AdjustedY0   = Y - X%*%betaY0 - "
"0","                     (D - X%*%betaD0)*est$CACE"
"0","  VarAdj       = var(AdjustedY1[Z==1])/sum(Z) + "
"0","                     var(AdjustedY0[Z==0])/sum(1 - Z)"
"0","  "
"0","  return(sqrt(VarAdj)/abs(est$tau_D))"
"0","}"
