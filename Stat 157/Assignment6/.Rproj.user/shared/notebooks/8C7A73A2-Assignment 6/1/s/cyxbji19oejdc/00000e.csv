"0","# 2SLS"
"0","TSLS <- function(Z, D, Y, X=0){"
"0","  X = as.matrix(X)"
"0","  D = as.matrix(D)"
"0","  Y = as.matrix(Y)"
"0","  Z = as.matrix(Z)"
"0","  Dhat    = lm(D ~ Z + X)$fitted.values"
"0","  tslsreg = lm(Y ~ Dhat + X)"
"0","  LATE <- coef(tslsreg)[2]"
"0","  res.correct       = Y - cbind(1, D, X)%*%coef(tslsreg)"
"0","  tslsreg$residuals = as.vector(res.correct)"
"0","  stderr <- sqrt(hccm(tslsreg, type = ""hc0"")[2, 2])"
"0","  return(list(""LATE"" = LATE, ""se"" = stderr))"
"0","}"
"0","print(paste(""The point estimate of the causal effect is "", TSLS(Z, D, Y, X)$LATE, "" and the CI is ["", TSLS(Z, D, Y, X)$LATE - 1.96*TSLS(Z, D, Y, X)$se,"","",TSLS(Z, D, Y, X)$LATE + 1.96*TSLS(Z, D, Y, X)$se, ""]"", sep = """"))"
"1","[1]"
"1"," ""The point estimate of the causal effect is 1.61775198587005 and the CI is [-9.22563773240543,12.4611417041455]"""
"1","
"
"0","# That's no longer significantly different from zero!"
