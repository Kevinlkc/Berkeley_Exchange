"0","C <- function(x, group){"
"0","  m <- apply(x, 2, mean)"
"0","  group <- factor(group)"
"0","  result = matrix(0, nrow = ncol(x), ncol = ncol(x))"
"0","  for (j in 1:ncol(x)){"
"0","    k = 0"
"0","    for (i in levels(group)){"
"0","      subgroup = x[group == i, ]"
"0","      k = k+1"
"0","      result[j,k] = sqrt(nrow(subgroup) / (nrow(x)-1)) * (mean(subgroup[,j]) - m[j])"
"0","    }"
"0","  }"
"0","  return(result)"
"0","}"
"0","# Verify that the decompostion is correct"
"0","round(C(iris[ ,1:4], iris$Species) %*% t(C(iris[ ,1:4], iris$Species)) -between_variance(iris[ ,1:4], iris$Species))"
"1","    "
"1"," Sepal.Length"
"1"," Sepal.Width"
"1"," Petal.Length"
"1"," Petal.Width"
"1","
[1,]"
"1","            0"
"1","           0"
"1","            0"
"1","           0"
"1","
[2,]"
"1","            0"
"1","           0"
"1","            0"
"1","           0"
"1","
[3,]"
"1","            0"
"1","           0"
"1","            0"
"1","           0"
"1","
[4,]"
"1","            0"
"1","           0"
"1","            0"
"1","           0"
"1","
"
"0","C <- C(iris[ ,1:4], iris$Species)"
